import{j as N,r as u,m as q,J as R,U as I,H as M,C as V,R as T,b as A,d as E,c as H,G as z,e as b,f as v,o as g,g as L,N as W,h as F,i as k,k as G,l as O,n as B,p as D,Q as J,q as U,V as X,s as K,t as Q,P as Y,u as Z,I as ee}from"./vendor-9741ff7b.js";import"./lodash-0223fb8a.js";import"./bignumber-63705fc6.js";const S=N.Fragment,s=N.jsx,h=N.jsxs,te="mainnet",ne="6849db0c57e4bf778ed8bdd2d721ee4f",we="erd1qqqqqqqqqqqqqpgqq72p4p73sx6wkurl3epefzt4dkvwh7frvp3s73l9k6",se="erd1qqqqqqqqqqqqqpgq8c2s6jf7je90x5wy843c2e8nlekejrf7vp3sxrvnka",ye="erd158lk5s2m3cpjyg5fwgm0pwnt8ugnc29mj4nafkrvcrhfdfpgvp3swpmnrj",ae=({sessionId:t,initialShowLogin:o})=>{const[n,e]=u.useState(o||!1),l=q();u.useEffect(()=>{l!=null&&l.address&&n&&e(o)},[n,l]);const d=[n&&s(R,{isWalletConnectV2:!0,token:t,logoutRoute:window.location.href,className:"text-xs p-2 mx-0 bg-secondary shadow-box hover:shadow-boxhvr text-black"},"wallet-connect"),n&&s(I,{token:t,className:"text-xs p-2 mx-0 bg-secondary shadow-box hover:shadow-boxhvr text-black"},"ledger"),n&&s(M,{className:"text-xs p-2 mx-0 bg-secondary shadow-box hover:shadow-boxhvr text-black",token:t,loginButtonText:"MultiversX DeFi Wallet"},"ext"),n&&s(V,{token:t,callbackRoute:window.location.pathname,className:"text-xs p-2 mx-0 bg-secondary shadow-box hover:shadow-boxhvr text-black",onLoginRedirect:{callbackRoute:window.location.pathname},nativeAuth:!0},"web")].filter(Boolean);return{showLogin:n,setShowLogin:e,loginActions:d}},$=T({key:"session",default:""}),be=T({key:"tempAd",default:{_title:""}}),_=T({key:"timesPlayed",default:{}}),oe=t=>{const[o,n]=A($),e=q();E();const{loginActions:l}=ae({sessionId:o,initialShowLogin:!0}),d=[...l].filter(Boolean);return u.useEffect(()=>{if(!t.login)return;let a=function(r){t.intended?window.location.href=t.intended:r.detail.loginInfo.loginMethod!=="wallet"&&window.location.reload()};return document.addEventListener("loginVerified",a),()=>{document.removeEventListener("loginVerified",a)}},[t.login,t.intended]),s(S,{children:h("div",{className:H("mt-3 flex gap-2",{"flex-col mt-4":!1,"self-end justify-end":!t.login,"self-center justify-center":t.login}),children:[!(e!=null&&e.address)&&s(S,{children:d}),e.address&&s(S,{children:s("button",{className:"p-2 bg-secondary shadow-box hover:shadow-boxhvr text-xs text-black",onClick:a=>{a.preventDefault(),z()},children:"Logout"})})]})})},y=new b.GraphQLClient("/gql");y.setHeader("X-Requested-With","XMLHttpRequest");y.setHeader("Accept","application/json");const re=t=>{const o=q(),[n,e]=A(_),l=Array.from(document.querySelectorAll("[data-game-counter-mini-app]")),d=u.useCallback(async()=>{let a=await y.batchRequests(t.nfts.map(i=>({document:b.gql`
                    query timesPlayedNft($identifier: String!, $nonce: Int!, $guestAddress: String) {
                        timesPlayedNft(identifier: $identifier, nonce: $nonce, guestAddress: $guestAddress) {
                            nonce
                            played_by_filip
                            played_by_you
                        }
                    }
                `,variables:{identifier:i.identifier,nonce:i.nonce,guestAddress:(o==null?void 0:o.address)||null}}))),r={};for(let i of a)r[i.data.timesPlayedNft.nonce]=i.data.timesPlayedNft;e(r)},[t.nfts,o.address]);return u.useEffect(()=>{const a=()=>{d()};return window.addEventListener("clearPlayCount",a),()=>{window.removeEventListener("clearPlayCount",a)}},[]),u.useEffect(()=>{t.nfts&&t.nfts.length>0&&d()},[t.nfts,o.address]),s(S,{children:l.map(a=>{const r=JSON.parse(a.dataset.nft);return v.createPortal(s(ie,{nft:r,owner:a.dataset.owner},`mini-app-${t.ikey}-${r.identifier}`),a)})})},ie=t=>{const[o,n]=A(_),e=o[t.nft.nonce]||{played_by_filip:0,played_by_you:0},l=q(),d=u.useCallback(async()=>{const a=new g.ArgSerializer;let r="ESDTNFTTransfer";r+="@"+a.valuesToString([new g.StringValue(t.nft.collection)]).argumentsString,r+="@"+a.valuesToString([new L(t.nft.nonce)]).argumentsString,r+="@"+a.valuesToString([new L(1)]).argumentsString,r+="@"+a.valuesToString([new g.AddressValue(new g.Address(se))]).argumentsString,r+="@"+a.valuesToString([new g.StringValue("markPlayed")]).argumentsString;const i={value:"0",data:r,receiver:l.address,gasLimit:"60000000"};await W(),await F({transactions:i,transactionsDisplayInfo:{processingMessage:"Processing increment game play counter transaction...",errorMessage:"Error incrementing game play counter",successMessage:"Successfully incremented game play counter"},redirectAfterSign:!1})},[t.nft]);return h("div",{className:"flex flex-col items-center",children:[h("div",{className:"font-bold text-sm mt-2 mb-2",children:["Number of times played by Filip: ",e==null?void 0:e.played_by_filip]}),l.address&&h("div",{className:"flex flex-col items-center",children:[l.address!=t.owner&&h("div",{className:"font-bold text-sm mb-2",children:["Number of times played by you: ",e==null?void 0:e.played_by_you]}),l.address==t.nft.owner&&s("div",{children:s("button",{className:"inline-block group bg-mxYellow hover:shadow-boxhvr p-1 hover:pb-3 shadow-box border-2 border-black text-xs",onClick:d,children:s("span",{className:"relative show-border smaller",children:"++ Increment play count"})})})]})]})},le=()=>{const[,t]=k.useState(),o=k.useCallback(()=>t({}),[]),[n,e]=k.useState(0);let l=Array.from(document.querySelectorAll("[data-web3-state-management]")),d=document.querySelector("[data-game-counter-app]");return window.rerenderLivewireableComponents=()=>{e(a=>a+1),o()},h(S,{children:[l.map(a=>{let r=!1;a.dataset.login==="1"&&(r=!0);const i=a.dataset.intended;return v.createPortal(s(u.Suspense,{fallback:s("div",{}),children:s(oe,{login:r,intended:i})}),a)}),d&&v.createPortal(s(u.Suspense,{fallback:s("div",{}),children:s(re,{nfts:JSON.parse(d.dataset.nfts),ikey:n})}),d,`game-counter-${n}`)]})},ce=k.lazy(()=>import("./MainAdSpaceApp-e7bbed8b.js")),de=({children:t,allAds:o})=>{const[,n]=k.useState();return k.useCallback(()=>n({}),[]),s(G,{children:h(O,{environment:te,customNetworkConfig:{walletConnectV2ProjectId:ne},dappConfig:{logoutRoute:window.location.href},children:[t,o.map(e=>{if(e.dataset.rendered==="true")return!1;const l=e.innerHTML;return e.innerHTML="",setTimeout(()=>{e.dataset.rendered="true"}),v.createPortal(s(u.Suspense,{fallback:s("div",{}),children:s(ce,{name:e.dataset.spaceName,language:e.dataset.language,format:e.dataset.format,sidebar:e.dataset.sidebar==1,info:e.dataset.initialInfo?JSON.parse(e.dataset.initialInfo):{},session:e.dataset.sessionId,html:l})}),e)}).filter(e=>e!==!1),s(le,{})]})})},ue=()=>{var r;const t=B(),o=D(),n=E(),e=q(),[l,d]=A($),a=()=>{for(let i=0;i<sessionStorage.length;i++){let c=sessionStorage.key(i);c!=null&&c.startsWith("authToken")&&sessionStorage.removeItem(c)}};return u.useEffect(()=>{let i=document.querySelector("[data-web3-space]");if(i){d(i.dataset.sessionId);return}y.request(b.gql`
                {
                    sessionInfo {
                        id
                    }
                }
            `).then(c=>{d(c.sessionInfo.id)})},[]),u.useEffect(()=>{var p;const i=document.cookie.split(";");let c=null,m=i.filter(w=>w.trim().startsWith("blog_token="));m.length>0&&(m=m[0].split("="),m.length>1&&(c=m[1]));const x=c;if(console.log({has:x,loginInfo:n,accountInfo:e}),(!((p=n==null?void 0:n.tokenLogin)!=null&&p.loginToken)||!e.address)&&c){const w=b.gql`
                mutation {
                    logout
                }
            `;c&&(y.request(w).then(()=>{setTimeout(()=>{window.location.reload()},300)}),a());return}(async()=>{if(!x&&e.address&&e.address.length>0&&n.tokenLogin.signature&&n.tokenLogin.signature.length>0){const w=b.gql`
                    mutation (
                        $address: String!
                        $signature: String!
                        $token: String
                    ) {
                        verifyLogin(
                            address: $address
                            signature: $signature
                            token: $token
                        ) {
                            success
                            # token
                        }
                    }
                `;if((await y.request(w,{address:e.address,signature:n.tokenLogin.signature,token:n.tokenLogin.loginToken})).verifyLogin.success){const f=new CustomEvent("loginVerified",{detail:{accountInfo:e,loginInfo:n}});document.dispatchEvent(f)}}})()},[(r=n==null?void 0:n.tokenLogin)==null?void 0:r.loginToken,e.address]),u.useEffect(()=>{let i=t.signedTransactionsArray.filter(c=>c[1].status==="signed"||c[1].status==="success");for(const c of i){const[m,x]=c;for(let p of x.transactions){const w=p;p=new g.Transaction(p);let f=g.TransactionPayload.fromEncoded(p.getData()).getEncodedArguments();if(f.length>0&&f[0]==="signComment"&&setTimeout(()=>{o(J({transactionHash:w.hash,sessionId:m,status:U.success})),o(X({sessionId:m,status:K.success}))},1e3),f.length>0&&f[f.length-1]==="6d61726b506c61796564"&&x.status==="success"){const j=g.StringValue.fromHex(f[1]);let C=new g.ArgSerializer().stringToValues(f[2],[new g.EndpointParameterDefinition("nonce","nonce of nft",new g.U64Type)]);C=C[0].value.toNumber(),y.request(b.gql`
                            query clearCache(
                                $identifier: String!
                                $nonce: Int!
                                $guestAddress: String
                            ) {
                                clearPlayCount(
                                    identifier: $identifier
                                    nonce: $nonce
                                    guestAddress: $guestAddress
                                )
                            }
                        `,{identifier:j.valueOf(),nonce:C,guestAddress:e.address}).then(()=>{window.dispatchEvent(new CustomEvent("clearPlayCount",{}))})}}}},[t]),null},ge=async()=>{let t=document.querySelectorAll("[data-web3-space]");if(t.length===0)return;const o=Array.from(t),n=document.getElementsByClassName("dapp-required")[0];let e=document.createElement("div");e.setAttribute("id","app"),n.appendChild(e),Q(e).render(h(de,{allAds:o,children:[s(Y,{className:"transactions-toast-list",transactionToastClassName:"transactions-toast-class",successfulToastLifetime:3e4}),s(Z,{}),s(ee,{}),s(ue,{})]}))};ge();export{S as F,y as G,h as a,we as b,ye as c,s as j,$ as s,be as t,ae as u};
