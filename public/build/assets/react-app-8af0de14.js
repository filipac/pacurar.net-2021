import{j as N,r as g,m as S,J as j,U as I,H as M,C as V,R as $,b as v,c as B,G as H,d as b,e as k,o as f,f as C,N as O,g as W,h as x,i as z,k as G,l as D,n as F,p as U,Q as J,q as X,V as K,s as Q,t as Y,P as Z,u as ee,I as te}from"./vendor-65e31ccf.js";import"./lodash-0223fb8a.js";import"./bignumber-63705fc6.js";const q=N.Fragment,n=N.jsx,p=N.jsxs,se="modulepreload",ne=function(t){return"/wp-content/themes/pacurar2020/public/"+t},E={},ae=function(l,e,s){if(!e||e.length===0)return l();const d=document.getElementsByTagName("link");return Promise.all(e.map(c=>{if(c=ne(c),c in E)return;E[c]=!0;const o=c.endsWith(".css"),u=o?'[rel="stylesheet"]':"";if(!!s)for(let i=d.length-1;i>=0;i--){const m=d[i];if(m.href===c&&(!o||m.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${c}"]${u}`))return;const r=document.createElement("link");if(r.rel=o?"stylesheet":se,o||(r.as="script",r.crossOrigin=""),r.href=c,document.head.appendChild(r),o)return new Promise((i,m)=>{r.addEventListener("load",i),r.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${c}`)))})})).then(()=>l())},oe="mainnet",re="6849db0c57e4bf778ed8bdd2d721ee4f",ke="erd1qqqqqqqqqqqqqpgqq72p4p73sx6wkurl3epefzt4dkvwh7frvp3s73l9k6",ie="erd1qqqqqqqqqqqqqpgq8c2s6jf7je90x5wy843c2e8nlekejrf7vp3sxrvnka",xe="erd158lk5s2m3cpjyg5fwgm0pwnt8ugnc29mj4nafkrvcrhfdfpgvp3swpmnrj",ce=({sessionId:t,initialShowLogin:l})=>{const[e,s]=g.useState(l||!1),d=S();g.useEffect(()=>{d!=null&&d.address&&e&&s(l)},[e,d]);const c=[e&&n(j,{isWalletConnectV2:!0,token:t,logoutRoute:window.location.href,showScamPhishingAlert:!0,className:"text-xs p-2 mx-0 bg-secondary shadow-box hover:shadow-boxhvr text-black"}),e&&n(I,{token:t,showScamPhishingAlert:!0,className:"text-xs p-2 mx-0 bg-secondary shadow-box hover:shadow-boxhvr text-black"}),e&&n(M,{className:"text-xs p-2 mx-0 bg-secondary shadow-box hover:shadow-boxhvr text-black",token:t,loginButtonText:"MultiversX DeFi Wallet"}),e&&n(V,{token:t,callbackRoute:window.location.pathname,className:"text-xs p-2 mx-0 bg-secondary shadow-box hover:shadow-boxhvr text-black",onLoginRedirect:{callbackRoute:window.location.pathname},nativeAuth:!0})].filter(Boolean);return{showLogin:e,setShowLogin:s,loginActions:c}},_=$({key:"session",default:""}),qe=$({key:"tempAd",default:{_title:""}}),L=$({key:"timesPlayed",default:{}}),le=()=>{const[t,l]=v(_),e=S(),{loginActions:s}=ce({sessionId:t,initialShowLogin:!0}),d=[...s].filter(Boolean);return n(q,{children:p("div",{className:B("mt-3 self-end flex gap-2 justify-end",{"flex-col mt-4":!1}),children:[!(e!=null&&e.address)&&n(q,{children:d}),e.address&&n(q,{children:n("button",{className:"p-2 bg-secondary shadow-box hover:shadow-boxhvr text-xs text-black",onClick:c=>{c.preventDefault(),H()},children:"Logout"})})]})})},y=new b.GraphQLClient("/gql");y.setHeader("X-Requested-With","XMLHttpRequest");y.setHeader("Accept","application/json");const de=t=>{const l=S(),[e,s]=v(L),d=Array.from(document.querySelectorAll("[data-game-counter-mini-app]")),c=g.useCallback(async()=>{let o=await y.batchRequests(t.nfts.map(a=>({document:b.gql`
                    query timesPlayedNft($identifier: String!, $nonce: Int!, $guestAddress: String) {
                        timesPlayedNft(identifier: $identifier, nonce: $nonce, guestAddress: $guestAddress) {
                            nonce
                            played_by_filip
                            played_by_you
                        }
                    }
                `,variables:{identifier:a.identifier,nonce:a.nonce,guestAddress:(l==null?void 0:l.address)||null}}))),u={};for(let a of o)u[a.data.timesPlayedNft.nonce]=a.data.timesPlayedNft;s(u)},[t.nfts,l.address]);return g.useEffect(()=>{const o=()=>{c()};return window.addEventListener("clearPlayCount",o),()=>{window.removeEventListener("clearPlayCount",o)}},[]),g.useEffect(()=>{t.nfts&&t.nfts.length>0&&c()},[t.nfts,l.address]),n(q,{children:d.map(o=>{const u=JSON.parse(o.dataset.nft);return k.createPortal(n(ue,{nft:u,owner:o.dataset.owner},`mini-app-${t.ikey}-${u.identifier}`),o)})})},ue=t=>{const[l,e]=v(L),s=l[t.nft.nonce]||{played_by_filip:0,played_by_you:0},d=S(),c=g.useCallback(async()=>{const o=new f.ArgSerializer;let u="ESDTNFTTransfer";u+="@"+o.valuesToString([new f.StringValue(t.nft.collection)]).argumentsString,u+="@"+o.valuesToString([new C(t.nft.nonce)]).argumentsString,u+="@"+o.valuesToString([new C(1)]).argumentsString,u+="@"+o.valuesToString([new f.AddressValue(new f.Address(ie))]).argumentsString,u+="@"+o.valuesToString([new f.StringValue("markPlayed")]).argumentsString;const a={value:"0",data:u,receiver:d.address,gasLimit:"60000000"};await O(),await W({transactions:a,transactionsDisplayInfo:{processingMessage:"Processing increment game play counter transaction...",errorMessage:"Error incrementing game play counter",successMessage:"Successfully incremented game play counter"},redirectAfterSign:!1})},[t.nft]);return p("div",{className:"flex flex-col items-center",children:[p("div",{className:"font-bold text-sm mt-2 mb-2",children:["Number of times played by Filip: ",s==null?void 0:s.played_by_filip]}),d.address&&p("div",{className:"flex flex-col items-center",children:[d.address!=t.owner&&p("div",{className:"font-bold text-sm mb-2",children:["Number of times played by you: ",s==null?void 0:s.played_by_you]}),d.address==t.nft.owner&&n("div",{children:n("button",{className:"inline-block group bg-mxYellow hover:shadow-boxhvr p-1 hover:pb-3 shadow-box border-2 border-black text-xs",onClick:c,children:n("span",{className:"relative show-border smaller",children:"++ Increment play count"})})})]})]})},ge=x.lazy(()=>ae(()=>import("./MainAdSpaceApp-e7eac004.js"),["assets/MainAdSpaceApp-e7eac004.js","assets/vendor-65e31ccf.js","assets/bignumber-63705fc6.js","assets/lodash-0223fb8a.js"])),me=({children:t,allAds:l})=>{const[,e]=x.useState(),s=x.useCallback(()=>e({}),[]),[d,c]=x.useState(0);let o=Array.from(document.querySelectorAll("[data-web3-state-management]")),u=document.querySelector("[data-game-counter-app]");return window.renderGameCounter=()=>{c(a=>a+1),s()},console.log({gameCounterApp:u}),n(z,{children:p(G,{environment:oe,customNetworkConfig:{walletConnectV2ProjectId:re},dappConfig:{logoutRoute:window.location.href},children:[t,l.map(a=>{const r=a.innerHTML;return a.innerHTML="",k.createPortal(n(g.Suspense,{fallback:n("div",{}),children:n(ge,{name:a.dataset.spaceName,language:a.dataset.language,format:a.dataset.format,sidebar:a.dataset.sidebar==1,info:a.dataset.initialInfo?JSON.parse(a.dataset.initialInfo):{},session:a.dataset.sessionId,html:r})}),a)}),o.map(a=>k.createPortal(n(g.Suspense,{fallback:n("div",{}),children:n(le,{})}),a)),u&&k.createPortal(n(g.Suspense,{fallback:n("div",{}),children:n(de,{nfts:JSON.parse(u.dataset.nfts),ikey:d})}),u,`game-counter-${d}`)]})})},fe=()=>{var a;const t=D(),l=F(),e=U(),s=S(),[d,c]=v(_),o=()=>{for(let r=0;r<sessionStorage.length;r++){let i=sessionStorage.key(r);i!=null&&i.startsWith("authToken")&&sessionStorage.removeItem(i)}},u=()=>{for(let r=0;r<sessionStorage.length;r++){let i=sessionStorage.key(r);if(i!=null&&i.startsWith("authToken"))return!0}return!1};return g.useEffect(()=>{let r=document.querySelector("[data-web3-space]");if(r){c(r.dataset.sessionId);return}y.request(b.gql`
            { sessionInfo { id } }
        `).then(i=>{c(i.sessionInfo.id)})},[]),g.useEffect(()=>{var i;if(!((i=e==null?void 0:e.tokenLogin)!=null&&i.loginToken)||!s.address){const m=b.gql`
                mutation {
                    logout
                }
            `;u()&&(y.request(m),o());return}const r=sessionStorage.getItem(`authToken${s.address}${e.tokenLogin.loginToken}`);(async()=>{if(!r){const m=b.gql`
                    mutation($address: String!, $signature: String!, $token: String) {
                        verifyLogin(address: $address, signature: $signature, token: $token) {
                            success
                            # token
                        }
                    }
                `;if((await y.request(m,{address:s.address,signature:e.tokenLogin.signature,token:e.tokenLogin.loginToken})).verifyLogin.success){const w="1";sessionStorage.setItem(`authToken${s.address}${e.tokenLogin.loginToken}`,w)}}})()},[(a=e==null?void 0:e.tokenLogin)==null?void 0:a.loginToken,s.address]),g.useEffect(()=>{let r=t.signedTransactionsArray.filter(i=>i[1].status==="signed"||i[1].status==="success");for(const i of r){const[m,A]=i;for(let w of A.transactions){const P=w;w=new f.Transaction(w);let h=f.TransactionPayload.fromEncoded(w.getData()).getEncodedArguments();if(h.length>0&&h[0]==="signComment"&&setTimeout(()=>{l(J({transactionHash:P.hash,sessionId:m,status:X.success})),l(K({sessionId:m,status:Q.success}))},1e3),h.length>0&&h[h.length-1]==="6d61726b506c61796564"&&A.status==="success"){const R=f.StringValue.fromHex(h[1]);let T=new f.ArgSerializer().stringToValues(h[2],[new f.EndpointParameterDefinition("nonce","nonce of nft",new f.U64Type)]);T=T[0].value.toNumber(),y.request(b.gql`
                        query clearCache($identifier: String!, $nonce: Int!, $guestAddress: String) {
                            clearPlayCount(identifier: $identifier, nonce: $nonce, guestAddress: $guestAddress)
                        }
                    `,{identifier:R.valueOf(),nonce:T,guestAddress:s.address}).then(()=>{window.dispatchEvent(new CustomEvent("clearPlayCount",{}))})}}}},[t]),null},he=async()=>{let t=document.querySelectorAll("[data-web3-space]");if(t.length===0)return;const l=Array.from(t),e=document.getElementsByClassName("dapp-required")[0];let s=document.createElement("div");s.setAttribute("id","app"),e.appendChild(s),Y(s).render(p(me,{allAds:l,children:[n(Z,{className:"transactions-toast-list",transactionToastClassName:"transactions-toast-class",successfulToastLifetime:3e4}),n(ee,{}),n(te,{}),n(fe,{})]}))};he();export{q as F,y as G,ae as _,p as a,ke as b,xe as c,n as j,_ as s,qe as t,ce as u};
