import{r as u,p as y,j as t,F as L,q as P,Y as $,v as R,R as j,b as q,x as T,c as I,Z as V,d as p,e as S,o as g,n as A,C as M,k as F,f as b,_ as B,g as z,h as H,i as O,l as W,Q as D,I as U,V as G,m as J,s as X,B as K,J as Q,t as Y}from"./vendor-DZp4qUgB.js";import"./bignumber-L0kgG1Q3.js";import"./lodash-C-76dkfd.js";const Z="mainnet",ee="6849db0c57e4bf778ed8bdd2d721ee4f",xe="erd1qqqqqqqqqqqqqpgqq72p4p73sx6wkurl3epefzt4dkvwh7frvp3s73l9k6",te="erd1qqqqqqqqqqqqqpgq8c2s6jf7je90x5wy843c2e8nlekejrf7vp3sxrvnka",he="erd158lk5s2m3cpjyg5fwgm0pwnt8ugnc29mj4nafkrvcrhfdfpgvp3swpmnrj",se=({sessionId:s,initialShowLogin:o})=>{const[n,e]=u.useState(o||!1),l=y();u.useEffect(()=>{l!=null&&l.address&&n&&e(o)},[n,l]);const d=[n&&t.jsx(L,{nativeAuth:!0,token:s,logoutRoute:window.location.href,loginButtonText:"xPortal",className:"text-xs p-2 mx-0 bg-secondary shadow-box hover:shadow-boxhvr text-black"},"wallet-connect"),n&&t.jsx(P,{token:s,className:"text-xs p-2 mx-0 bg-secondary shadow-box hover:shadow-boxhvr text-black"},"ledger"),n&&t.jsx($,{className:"text-xs p-2 mx-0 bg-secondary shadow-box hover:shadow-boxhvr text-black",token:s,loginButtonText:"MultiversX DeFi Wallet"},"ext"),n&&t.jsx(R,{token:s,callbackRoute:window.location.pathname,className:"text-xs p-2 mx-0 bg-secondary shadow-box hover:shadow-boxhvr text-black",onLoginRedirect:{callbackRoute:window.location.pathname},nativeAuth:!0},"web")].filter(Boolean);return{showLogin:n,setShowLogin:e,loginActions:d}},_=j({key:"session",default:""}),we=j({key:"tempAd",default:{_title:""}}),C=j({key:"timesPlayed",default:{}}),ne=s=>{const[o,n]=q(_),e=y();T();const{loginActions:l}=se({sessionId:o,initialShowLogin:!0}),d=[...l].filter(Boolean);return u.useEffect(()=>{if(!s.login)return;let a=function(r){s.intended?window.location.href=s.intended:r.detail.loginInfo.loginMethod!=="wallet"&&window.location.reload()};return document.addEventListener("loginVerified",a),()=>{document.removeEventListener("loginVerified",a)}},[s.login,s.intended]),t.jsx(t.Fragment,{children:t.jsxs("div",{className:I("mt-3 flex gap-2",{"flex-col mt-4":!1,"self-end justify-end":!s.login,"self-center justify-center":s.login}),children:[!(e!=null&&e.address)&&t.jsx(t.Fragment,{children:d}),e.address&&t.jsx(t.Fragment,{children:t.jsx("button",{className:"p-2 bg-secondary shadow-box hover:shadow-boxhvr text-xs text-black",onClick:a=>{a.preventDefault(),V()},children:"Logout"})})]})})},w=new p.GraphQLClient("/gql");w.setHeader("X-Requested-With","XMLHttpRequest");w.setHeader("Accept","application/json");const ae=s=>{const o=y(),[n,e]=q(C),l=Array.from(document.querySelectorAll("[data-game-counter-mini-app]")),d=u.useCallback(async()=>{let a=await w.batchRequests(s.nfts.map(i=>({document:p.gql`
                    query timesPlayedNft($identifier: String!, $nonce: Int!, $guestAddress: String) {
                        timesPlayedNft(identifier: $identifier, nonce: $nonce, guestAddress: $guestAddress) {
                            nonce
                            played_by_filip
                            played_by_you
                        }
                    }
                `,variables:{identifier:i.identifier,nonce:i.nonce,guestAddress:(o==null?void 0:o.address)||null}}))),r={};for(let i of a)r[i.data.timesPlayedNft.nonce]=i.data.timesPlayedNft;e(r)},[s.nfts,o.address]);return u.useEffect(()=>{const a=()=>{d()};return window.addEventListener("clearPlayCount",a),()=>{window.removeEventListener("clearPlayCount",a)}},[]),u.useEffect(()=>{s.nfts&&s.nfts.length>0&&d()},[s.nfts,o.address]),t.jsx(t.Fragment,{children:l.map(a=>{const r=JSON.parse(a.dataset.nft);return S.createPortal(t.jsx(oe,{nft:r,owner:a.dataset.owner},`mini-app-${s.ikey}-${r.identifier}`),a)})})},oe=s=>{const[o,n]=q(C),e=o[s.nft.nonce]||{played_by_filip:0,played_by_you:0},l=y(),d=u.useCallback(async()=>{const a=new g.ArgSerializer;let r="ESDTNFTTransfer";r+="@"+a.valuesToString([new g.StringValue(s.nft.collection)]).argumentsString,r+="@"+a.valuesToString([new A.U64Value(s.nft.nonce)]).argumentsString,r+="@"+a.valuesToString([new A.U64Value(1)]).argumentsString,r+="@"+a.valuesToString([new g.AddressValue(new g.Address(te))]).argumentsString,r+="@"+a.valuesToString([new g.StringValue("markPlayed")]).argumentsString;const i={value:"0",data:r,receiver:l.address,gasLimit:"60000000"};await M();const{sessionId:c}=await F({transactions:i,transactionsDisplayInfo:{processingMessage:"Processing increment game play counter transaction...",errorMessage:"Error incrementing game play counter",successMessage:"Successfully incremented game play counter"},redirectAfterSign:!1})},[s.nft]);return t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsxs("div",{className:"font-bold text-sm mt-2 mb-2",children:["Number of times played by Filip: ",e==null?void 0:e.played_by_filip]}),l.address&&t.jsxs("div",{className:"flex flex-col items-center",children:[l.address!=s.owner&&t.jsxs("div",{className:"font-bold text-sm mb-2",children:["Number of times played by you: ",e==null?void 0:e.played_by_you]}),l.address==s.nft.owner&&t.jsx("div",{children:t.jsx("button",{className:"inline-block group bg-mxYellow hover:shadow-boxhvr p-1 hover:pb-3 shadow-box border-2 border-black text-xs",onClick:d,children:t.jsx("span",{className:"relative show-border smaller",children:"++ Increment play count"})})})]})]})},re=()=>{const[,s]=b.useState(),o=b.useCallback(()=>s({}),[]),[n,e]=b.useState(0);let l=Array.from(document.querySelectorAll("[data-web3-state-management]")),d=document.querySelector("[data-game-counter-app]");return window.rerenderLivewireableComponents=()=>{e(a=>a+1),o()},t.jsxs(t.Fragment,{children:[l.map(a=>{let r=!1;a.dataset.login==="1"&&(r=!0);const i=a.dataset.intended;return S.createPortal(t.jsx(u.Suspense,{fallback:t.jsx("div",{}),children:t.jsx(ne,{login:r,intended:i})}),a)}),d&&S.createPortal(t.jsx(u.Suspense,{fallback:t.jsx("div",{}),children:t.jsx(ae,{nfts:JSON.parse(d.dataset.nfts),ikey:n})}),d,`game-counter-${n}`)]})},ie=b.lazy(()=>B(()=>import("./MainAdSpaceApp-DGt01_wo.js"),[])),le=({children:s,allAds:o})=>{const[,n]=b.useState();return b.useCallback(()=>n({}),[]),t.jsx(z,{children:t.jsxs(H,{environment:Z,customNetworkConfig:{name:"customConfig",apiTimeout:6e3,walletConnectV2ProjectId:ee},dappConfig:{shouldUseWebViewProvider:!0,logoutRoute:window.location.href},children:[s,o.map(e=>{if(e.dataset.rendered==="true")return!1;const l=e.innerHTML;return e.innerHTML="",setTimeout(()=>{e.dataset.rendered="true"}),S.createPortal(t.jsx(u.Suspense,{fallback:t.jsx("div",{}),children:t.jsx(ie,{name:e.dataset.spaceName,language:e.dataset.language,format:e.dataset.format,sidebar:e.dataset.sidebar==1,info:e.dataset.initialInfo?JSON.parse(e.dataset.initialInfo):{},session:e.dataset.sessionId,html:l})}),e)}).filter(e=>e!==!1),t.jsx(re,{})]})})},ce=()=>{var r;const s=O(),o=W(),n=T(),e=y(),[l,d]=q(_),a=()=>{for(let i=0;i<sessionStorage.length;i++){let c=sessionStorage.key(i);c!=null&&c.startsWith("authToken")&&sessionStorage.removeItem(c)}};return u.useEffect(()=>{let i=document.querySelector("[data-web3-space]");if(i){d(i.dataset.sessionId);return}w.request(p.gql`
                {
                    sessionInfo {
                        id
                    }
                }
            `).then(c=>{d(c.sessionInfo.id)})},[]),u.useEffect(()=>{var x;const i=document.cookie.split(";");let c=null,m=i.filter(h=>h.trim().startsWith("blog_token="));m.length>0&&(m=m[0].split("="),m.length>1&&(c=m[1]));const k=c;if((!((x=n==null?void 0:n.tokenLogin)!=null&&x.loginToken)||!e.address)&&c){const h=p.gql`
                mutation {
                    logout
                }
            `;c&&(w.request(h).then(()=>{setTimeout(()=>{window.location.reload()},300)}),a());return}(async()=>{if(!k&&e.address&&e.address.length>0&&n.tokenLogin.signature&&n.tokenLogin.signature.length>0){const h=p.gql`
                    mutation (
                        $address: String!
                        $signature: String!
                        $token: String
                    ) {
                        verifyLogin(
                            address: $address
                            signature: $signature
                            token: $token
                        ) {
                            success
                            # token
                        }
                    }
                `;if((await w.request(h,{address:e.address,signature:n.tokenLogin.signature,token:n.tokenLogin.loginToken})).verifyLogin.success){const f=new CustomEvent("loginVerified",{detail:{accountInfo:e,loginInfo:n}});document.dispatchEvent(f)}}})()},[(r=n==null?void 0:n.tokenLogin)==null?void 0:r.loginToken,e.address]),u.useEffect(()=>{let i=s.signedTransactionsArray.filter(c=>c[1].status==="signed"||c[1].status==="success");for(const c of i){const[m,k]=c;for(let x of k.transactions){const h=x;x=new g.Transaction(x);let f=g.TransactionPayload.fromEncoded(x.getData()).getEncodedArguments();if(f.length>0&&f[0]==="signComment"&&setTimeout(()=>{o(D({transactionHash:h.hash,sessionId:m,status:U.success})),o(G({sessionId:m,status:J.success}))},1e3),f.length>0&&f[f.length-1]==="6d61726b506c61796564"&&k.status==="success"){const N=g.StringValue.fromHex(f[1]);let v=new g.ArgSerializer().stringToValues(f[2],[new g.EndpointParameterDefinition("nonce","nonce of nft",new g.U64Type)]);v=v[0].value.toNumber(),w.request(p.gql`
                            query clearCache(
                                $identifier: String!
                                $nonce: Int!
                                $guestAddress: String
                            ) {
                                clearPlayCount(
                                    identifier: $identifier
                                    nonce: $nonce
                                    guestAddress: $guestAddress
                                )
                            }
                        `,{identifier:N.valueOf(),nonce:v,guestAddress:e.address}).then(()=>{window.dispatchEvent(new CustomEvent("clearPlayCount",{}))})}}}},[s]),null};window._global||(window._global=window),window.global=window._global;const de=async()=>{let s=document.querySelectorAll("[data-web3-space]");if(s.length===0)return;const o=Array.from(s),n=document.getElementsByClassName("dapp-required")[0];let e=document.createElement("div");e.setAttribute("id","app"),n.appendChild(e),X.createRoot(e).render(t.jsxs(le,{allAds:o,children:[t.jsx(K,{className:"transactions-toast-list",transactionToastClassName:"transactions-toast-class",successfulToastLifetime:3e4}),t.jsx(Q,{}),t.jsx(Y,{}),t.jsx(ce,{})]}))};de();export{w as G,xe as a,he as c,_ as s,we as t,se as u};
