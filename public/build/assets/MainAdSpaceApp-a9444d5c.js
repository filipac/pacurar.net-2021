import{s as oe,t as de,G as le,c as M,j as t,a as i,F as a,u as ce,b as S}from"./react-app-7c47b6b5.js";import{f as _,p as he,b as $,s as me,r as o,z as ue,t as xe,u as be,d as pe,Z as we,c as d,F as ye,q as ve,Y as fe,v as Se,w as q,o as u,k as Y}from"./vendor-76713984.js";import"./bignumber-c60c4193.js";import"./lodash-42dc8045.js";const F=_.lazy(()=>import("./BuySpace-203b575d.js")),_e=_.lazy(()=>import("./SpaceEdit-f939e446.js")),Ee=({name:w="",language:r,html:y,format:R,sidebar:l,info:U,session:ge})=>{var P;const s=he(),[x,ke]=$(oe),f=me(),[e,V]=o.useState(U),[X,G]=o.useState(null);o.useEffect(()=>{let n=f.configuration;n.extraInfo={sessionId:x},ue(n).initialize().then(m=>{G(m),document.cookie=`login_token=${m};path=/;max-age=3600`})},[(P=f==null?void 0:f.configuration)==null?void 0:P.apiAddress,x]);const[z,b]=o.useState(!1),[v,g]=o.useState(!1),[Z,J]=o.useState(!0),[k]=$(de),L=(k==null?void 0:k[w])||"",[C,N]=o.useState(""),[A,D]=o.useState(null);o.useEffect(()=>{N(y||"")},[y]);const K=async()=>{console.log(await(async()=>{await Y({transactions:[{value:"0",data:"withdraw",receiver:S,gasLimit:"40000000"}],transactionsDisplayInfo:{processingMessage:r=="ro"?"Asteptam...":"Waiting...",successMessage:r=="ro"?"Au intrat banutii":"Money is in your wallet",transactionDuration:1e4}})})())},{successfulTransactionsArray:j}=xe(),{pendingTransactionsArray:O}=be(),Q=n=>{if(!n[1].transactions)return!1;const h=u.Transaction.fromPlainObject(n[1].transactions[0]);if(h.getReceiver().bech32()===S){let c=u.TransactionPayload.fromEncoded(h.getData().encoded()).getEncodedArguments();if(c.length===2&&c[0]==="resetSpace"&&c[1]===new u.ArgSerializer().valuesToString([new u.StringValue(e.name)]).argumentsString)return!0}return!1},I=n=>{if(!n[1].transactions)return!1;const h=u.Transaction.fromPlainObject(n[1].transactions[0]);if(h.getReceiver().bech32()===S){let c=u.TransactionPayload.fromEncoded(h.getData().encoded()).getEncodedArguments();if(c.length===1&&c[0]==="withdraw")return!0}return!1},B=o.useMemo(()=>j.some(Q),[j]),H=o.useMemo(()=>O.some(I),[O]);o.useEffect(()=>{B&&T(e.name)},[B]);const ee=async n=>{if(!n||n.length===0)return;console.log(await(async()=>{const m=new u.ArgSerializer;let c="resetSpace";c+="@"+m.valuesToString([new u.StringValue(n)]).argumentsString,await Y({transactions:[{value:"0",data:c,receiver:S,gasLimit:"40000000"}],transactionsDisplayInfo:{processingMessage:r=="ro"?"Asteptam...":"Waiting...",successMessage:r=="ro"?"Spatiul a fost resetat":"Space was reset",transactionDuration:1e4}})})())},T=async n=>{const m=(await le.request(pe.gql`
            query adSpaceInfo($spaceName: String!, $initial: Boolean) {
                adSpaceInfo(spaceName: $spaceName, initial: $initial) {
                    name
                    is_new
                    owner
                    paid_amount
                    paid_until
                }
            }
        `,{spaceName:n,initial:Z})).adSpaceInfo;V(m)};o.useEffect(()=>{(async()=>e!=null&&e.name||(await T(w),J(!0)))()},[w]);const E=o.useCallback(()=>{T(w)},[w]),te=[(s==null?void 0:s.address)==M&&t("div",{style:{flexBasis:"100%",height:0}},"emtpty-div"),(s==null?void 0:s.address)==M&&i("button",{className:"p-2 bg-secondary shadow-box hover:shadow-boxhvr text-xs text-black",onClick:n=>{n.preventDefault(),K()},children:[!H&&i(a,{children:[r=="en"&&t(a,{children:"Withdraw"}),r=="ro"&&t(a,{children:"Retrage banii"})]}),H&&t(a,{children:"..."})]},"withdraw-btn"),s.address&&s.address==M&&!(e!=null&&e.is_new)&&i("button",{className:"p-2 bg-red-500 text-white shadow-box hover:shadow-boxhvr text-xs text-black",onClick:n=>{n.preventDefault(),ee((e==null?void 0:e.name)||"")},children:[r=="en"&&t(a,{children:"Reset space"}),r=="ro"&&t(a,{children:"Reseteaza spatiul"})]},"reset-btn")],W=[s.address&&s.address!=(e==null?void 0:e.owner)&&!(e!=null&&e.is_new)&&i("button",{className:"p-2 bg-secondary shadow-box hover:shadow-boxhvr text-xs text-black",onClick:n=>{n.preventDefault(),b(!0)},children:[r=="en"&&t(a,{children:"Replace with your advertisement"}),r=="ro"&&t(a,{children:"Inlocuieste cu reclama ta"})]},"replace-btn"),s.address&&s.address==(e==null?void 0:e.owner)&&!(e!=null&&e.is_new)&&!v&&i("button",{className:"p-2 bg-secondary shadow-box hover:shadow-boxhvr text-xs text-black",onClick:n=>{n.preventDefault(),g(!0)},children:[r=="en"&&t(a,{children:"Edit space"}),r=="ro"&&t(a,{children:"Editeaza spatiul"})]},"edit-btn"),s.address&&s.address==(e==null?void 0:e.owner)&&!(e!=null&&e.is_new)&&v&&i("button",{className:"p-2 bg-secondary shadow-box hover:shadow-boxhvr text-xs text-black",onClick:n=>{n.preventDefault(),g(!1)},children:[r=="en"&&t(a,{children:"Cancel edit"}),r=="ro"&&t(a,{children:"Anuleaza editarea"})]},"cancel-btn"),i("button",{className:"p-2 bg-secondary shadow-box hover:shadow-boxhvr text-xs text-black",onClick:n=>{n.preventDefault(),we()},children:[r=="en"&&t(a,{children:"Logout"}),r=="ro"&&t(a,{children:"Logout"})]},"logout-btn"),...te].filter(Boolean),{showLogin:p,setShowLogin:se,loginActions:ae}=ce({sessionId:x});o.useEffect(()=>{s!=null&&s.address&&p&&D(null)},[p,s]),o.useEffect(()=>{s!=null&&s.address&&A&&A=="outbid"&&(e.owner&&e.owner!=s.address&&b(!0),D(null))},[A,s==null?void 0:s.address,e]);const ne=[!(e!=null&&e.is_new)&&i("button",{className:"dapp-core-component__main__btn dapp-core-component__main__btn-primary dapp-core-component__main__m-1 text-xs p-2 mx-0 bg-yellow-500 shadow-box hover:shadow-boxhvr text-black",onClick:n=>{n.preventDefault(),s!=null&&s.address?b(!0):(se(!p),D(p?null:"outbid"))},children:[p&&i(a,{children:[r=="en"&&t(a,{children:"Cancel outbid"}),r=="ro"&&t(a,{children:"Renunta"})]}),!p&&i(a,{children:[r=="en"&&t(a,{children:"Replace with your advertisement"}),r=="ro"&&t(a,{children:"Inlocuieste cu reclama ta"})]})]},"login-btn"),...ae].filter(Boolean);if(!(e!=null&&e.name)&&y&&y.length>1)return t(a,{children:t("div",{className:d("bg-primary py-4 px-4",{}),children:e&&!(e!=null&&e.is_new)&&t("div",{className:"space__content",dangerouslySetInnerHTML:{__html:v?L:C}})})});if(e!=null&&e.is_new)return t("div",{className:d("py-4 px-4",{"bg-primary":R=="light","bg-splash text-white":R=="dark"}),children:i("div",{className:"flex flex-col items-center justify-center",children:[(!s.address||s.address&&e.owner!=s.address)&&i(a,{children:[r=="ro"&&i(a,{children:[t("div",{className:d("font-bold text-center",{"text-2xl":!l,"mb-4":l}),children:"Acest spatiu publicitar poate fi tau pentru 10 de zile."}),i("p",{className:d("text-center",{"mb-4":l}),children:["Costa doar ",e==null?void 0:e.paid_amount," USDC/USDT / 10 zile.",t("br",{}),"Il inchiriezi instant cu ajutorul blockchain-ului MultiversX si il poti personaliza cum vrei tu."]})]}),r=="en"&&i(a,{children:[t("div",{className:d("font-bold",{"text-2xl":!l,"mb-4":l}),children:"This ad space can be yours for 10 days."}),i("p",{className:d("text-center",{"mb-4":l}),children:["It costs only ",e==null?void 0:e.paid_amount," USDC/USDT per 10 days.",t("br",{})," You rent it instantly using the MultiversX blockchain and you can customize it as you want."]})]})]}),!s.address&&t(a,{children:i("div",{className:d("flex mt-2 flex-col items-center md:flex-row",{"flex flex-col md:flex-col gap-2":l}),children:[t(ye,{nativeAuth:!0,token:x,logoutRoute:window.location.href,className:"text-xs p-2 mx-0 bg-secondary shadow-box hover:shadow-boxhvr text-black border-secondary"}),t(ve,{token:x,showScamPhishingAlert:!0,className:"text-xs p-2 ml-4 bg-secondary shadow-box hover:shadow-boxhvr text-black  border-secondary"}),t(fe,{className:"text-xs p-2 mx-0 bg-secondary shadow-box hover:shadow-boxhvr text-black border-secondary",token:x,loginButtonText:"MultiversX DeFi Wallet"}),t(Se,{token:X,callbackRoute:window.location.pathname,className:"text-xs p-2 mx-0 ml-4 bg-secondary shadow-box hover:shadow-boxhvr text-black border-secondary"})]})}),s.address&&e.owner!=s.address&&t(a,{children:t("div",{className:d("mt-2",{"mt-4":l}),children:i("button",{className:"p-2 bg-secondary text-black shadow-box hover:shadow-boxhvr text-xs",onClick:n=>{n.preventDefault(),b(!0)},children:[r=="ro"&&t(a,{children:"Inchiriaza acest spatiu"}),r=="en"&&t(a,{children:"Rent this space"})]})})}),s.address&&t(a,{children:t("div",{className:d("mt-3 flex flex-wrap self-end justify-end gap-2 ml-auto",{"mt-4 transform scale-75 origin-right":l}),style:{width:"fit-content"},children:W})}),t(_.Suspense,{fallback:t("div",{}),children:t(F,{open:z,setOpen:b,spaceInfo:e,language:r,refreshSpace:E})})]})});const re=e!=null&&e.paid_until?q(new Date((e==null?void 0:e.paid_until)*1e3),"dd.MM.yyyy HH:mm"):"",ie=e!=null&&e.paid_until?q(new Date((e==null?void 0:e.paid_until)*1e3),"MM-dd-yyyy HH:mm a"):"";return i(a,{children:[i("div",{className:d("bg-primary py-4 px-4",{}),children:[(s==null?void 0:s.address)&&(e==null?void 0:e.owner)==s.address&&t(a,{children:i("div",{className:d("font-bold text-xs bg-secondary py-2 px-4 rounded-2xl max-w border border-black mb-2"),style:{maxWidth:"fit-content"},children:[r=="ro"&&i(a,{children:["Deti acest spatiu pana in ",re]}),r=="en"&&i(a,{children:["You own this space until ",ie]})]})}),e&&!(e!=null&&e.is_new)&&t("div",{className:"space__content",dangerouslySetInnerHTML:{__html:v?L:C}}),v&&t(a,{children:t(o.Suspense,{fallback:t("div",{children:"Loading"}),children:t(_e,{spaceInfo:e,close:()=>{g(!1)},sidebar:l,language:r,refreshSpace:n=>{E(),N(n)}})})}),e.name&&i(a,{children:[s.address&&t("div",{className:d("mt-3 flex flex-wrap self-end justify-end gap-2 ml-auto",{"mt-4 transform scale-75 origin-right":l}),style:{width:"fit-content"},children:W}),!(s!=null&&s.address)&&t("div",{className:d("mt-3 self-end flex gap-2 justify-end",{"flex-col mt-4":l}),children:ne})]})]}),t(_.Suspense,{fallback:t("div",{}),children:t(F,{open:z,setOpen:b,spaceInfo:e,language:r,refreshSpace:E})})]})};export{Ee as default};
