import{j as E,r as f,m as q,J as I,U as V,H as M,C as B,R as N,b as A,d as _,c as H,G as O,e as k,f as v,o as g,g as L,N as W,h as z,i as S,k as D,l as F,n as G,p as U,Q as J,q as X,V as K,s as Q,t as Y,P as Z,u as ee,I as te}from"./vendor-9741ff7b.js";import"./lodash-0223fb8a.js";import"./bignumber-63705fc6.js";const x=E.Fragment,a=E.jsx,w=E.jsxs,ne="modulepreload",se=function(t){return"/wp-content/themes/pacurar2020/public/"+t},T={},ae=function(r,n,e){if(!n||n.length===0)return r();const l=document.getElementsByTagName("link");return Promise.all(n.map(o=>{if(o=se(o),o in T)return;T[o]=!0;const s=o.endsWith(".css"),c=s?'[rel="stylesheet"]':"";if(!!e)for(let u=l.length-1;u>=0;u--){const m=l[u];if(m.href===o&&(!s||m.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${o}"]${c}`))return;const i=document.createElement("link");if(i.rel=s?"stylesheet":ne,s||(i.as="script",i.crossOrigin=""),i.href=o,document.head.appendChild(i),s)return new Promise((u,m)=>{i.addEventListener("load",u),i.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${o}`)))})})).then(()=>r())},oe="mainnet",re="6849db0c57e4bf778ed8bdd2d721ee4f",Se="erd1qqqqqqqqqqqqqpgqq72p4p73sx6wkurl3epefzt4dkvwh7frvp3s73l9k6",ie="erd1qqqqqqqqqqqqqpgq8c2s6jf7je90x5wy843c2e8nlekejrf7vp3sxrvnka",xe="erd158lk5s2m3cpjyg5fwgm0pwnt8ugnc29mj4nafkrvcrhfdfpgvp3swpmnrj",le=({sessionId:t,initialShowLogin:r})=>{const[n,e]=f.useState(r||!1),l=q();f.useEffect(()=>{l!=null&&l.address&&n&&e(r)},[n,l]);const o=[n&&a(I,{isWalletConnectV2:!0,token:t,logoutRoute:window.location.href,className:"text-xs p-2 mx-0 bg-secondary shadow-box hover:shadow-boxhvr text-black"},"wallet-connect"),n&&a(V,{token:t,className:"text-xs p-2 mx-0 bg-secondary shadow-box hover:shadow-boxhvr text-black"},"ledger"),n&&a(M,{className:"text-xs p-2 mx-0 bg-secondary shadow-box hover:shadow-boxhvr text-black",token:t,loginButtonText:"MultiversX DeFi Wallet"},"ext"),n&&a(B,{token:t,callbackRoute:window.location.pathname,className:"text-xs p-2 mx-0 bg-secondary shadow-box hover:shadow-boxhvr text-black",onLoginRedirect:{callbackRoute:window.location.pathname},nativeAuth:!0},"web")].filter(Boolean);return{showLogin:n,setShowLogin:e,loginActions:o}},$=N({key:"session",default:""}),qe=N({key:"tempAd",default:{_title:""}}),P=N({key:"timesPlayed",default:{}}),ce=t=>{const[r,n]=A($),e=q();_();const{loginActions:l}=le({sessionId:r,initialShowLogin:!0}),o=[...l].filter(Boolean);return f.useEffect(()=>{if(!t.login)return;let s=function(c){t.intended?window.location.href=t.intended:c.detail.loginInfo.loginMethod!=="wallet"&&window.location.reload()};return document.addEventListener("loginVerified",s),()=>{document.removeEventListener("loginVerified",s)}},[t.login,t.intended]),a(x,{children:w("div",{className:H("mt-3 flex gap-2",{"flex-col mt-4":!1,"self-end justify-end":!t.login,"self-center justify-center":t.login}),children:[!(e!=null&&e.address)&&a(x,{children:o}),e.address&&a(x,{children:a("button",{className:"p-2 bg-secondary shadow-box hover:shadow-boxhvr text-xs text-black",onClick:s=>{s.preventDefault(),O()},children:"Logout"})})]})})},b=new k.GraphQLClient("/gql");b.setHeader("X-Requested-With","XMLHttpRequest");b.setHeader("Accept","application/json");const de=t=>{const r=q(),[n,e]=A(P),l=Array.from(document.querySelectorAll("[data-game-counter-mini-app]")),o=f.useCallback(async()=>{let s=await b.batchRequests(t.nfts.map(d=>({document:k.gql`
                    query timesPlayedNft($identifier: String!, $nonce: Int!, $guestAddress: String) {
                        timesPlayedNft(identifier: $identifier, nonce: $nonce, guestAddress: $guestAddress) {
                            nonce
                            played_by_filip
                            played_by_you
                        }
                    }
                `,variables:{identifier:d.identifier,nonce:d.nonce,guestAddress:(r==null?void 0:r.address)||null}}))),c={};for(let d of s)c[d.data.timesPlayedNft.nonce]=d.data.timesPlayedNft;e(c)},[t.nfts,r.address]);return f.useEffect(()=>{const s=()=>{o()};return window.addEventListener("clearPlayCount",s),()=>{window.removeEventListener("clearPlayCount",s)}},[]),f.useEffect(()=>{t.nfts&&t.nfts.length>0&&o()},[t.nfts,r.address]),a(x,{children:l.map(s=>{const c=JSON.parse(s.dataset.nft);return v.createPortal(a(ue,{nft:c,owner:s.dataset.owner},`mini-app-${t.ikey}-${c.identifier}`),s)})})},ue=t=>{const[r,n]=A(P),e=r[t.nft.nonce]||{played_by_filip:0,played_by_you:0},l=q(),o=f.useCallback(async()=>{const s=new g.ArgSerializer;let c="ESDTNFTTransfer";c+="@"+s.valuesToString([new g.StringValue(t.nft.collection)]).argumentsString,c+="@"+s.valuesToString([new L(t.nft.nonce)]).argumentsString,c+="@"+s.valuesToString([new L(1)]).argumentsString,c+="@"+s.valuesToString([new g.AddressValue(new g.Address(ie))]).argumentsString,c+="@"+s.valuesToString([new g.StringValue("markPlayed")]).argumentsString;const d={value:"0",data:c,receiver:l.address,gasLimit:"60000000"};await W(),await z({transactions:d,transactionsDisplayInfo:{processingMessage:"Processing increment game play counter transaction...",errorMessage:"Error incrementing game play counter",successMessage:"Successfully incremented game play counter"},redirectAfterSign:!1})},[t.nft]);return w("div",{className:"flex flex-col items-center",children:[w("div",{className:"font-bold text-sm mt-2 mb-2",children:["Number of times played by Filip: ",e==null?void 0:e.played_by_filip]}),l.address&&w("div",{className:"flex flex-col items-center",children:[l.address!=t.owner&&w("div",{className:"font-bold text-sm mb-2",children:["Number of times played by you: ",e==null?void 0:e.played_by_you]}),l.address==t.nft.owner&&a("div",{children:a("button",{className:"inline-block group bg-mxYellow hover:shadow-boxhvr p-1 hover:pb-3 shadow-box border-2 border-black text-xs",onClick:o,children:a("span",{className:"relative show-border smaller",children:"++ Increment play count"})})})]})]})},fe=()=>{const[,t]=S.useState(),r=S.useCallback(()=>t({}),[]),[n,e]=S.useState(0);let l=Array.from(document.querySelectorAll("[data-web3-state-management]")),o=document.querySelector("[data-game-counter-app]");return window.rerenderLivewireableComponents=()=>{e(s=>s+1),r()},w(x,{children:[l.map(s=>{let c=!1;s.dataset.login==="1"&&(c=!0);const d=s.dataset.intended;return v.createPortal(a(f.Suspense,{fallback:a("div",{}),children:a(ce,{login:c,intended:d})}),s)}),o&&v.createPortal(a(f.Suspense,{fallback:a("div",{}),children:a(de,{nfts:JSON.parse(o.dataset.nfts),ikey:n})}),o,`game-counter-${n}`)]})},ge=S.lazy(()=>ae(()=>import("./MainAdSpaceApp-0fa8735f.js"),["assets/MainAdSpaceApp-0fa8735f.js","assets/vendor-9741ff7b.js","assets/bignumber-63705fc6.js","assets/lodash-0223fb8a.js"])),me=({children:t,allAds:r})=>{const[,n]=S.useState();return S.useCallback(()=>n({}),[]),a(D,{children:w(F,{environment:oe,customNetworkConfig:{walletConnectV2ProjectId:re},dappConfig:{logoutRoute:window.location.href},children:[t,r.map(e=>{if(e.dataset.rendered==="true")return!1;const l=e.innerHTML;return e.innerHTML="",setTimeout(()=>{e.dataset.rendered="true"}),v.createPortal(a(f.Suspense,{fallback:a("div",{}),children:a(ge,{name:e.dataset.spaceName,language:e.dataset.language,format:e.dataset.format,sidebar:e.dataset.sidebar==1,info:e.dataset.initialInfo?JSON.parse(e.dataset.initialInfo):{},session:e.dataset.sessionId,html:l})}),e)}).filter(e=>e!==!1),a(fe,{})]})})},he=()=>{var c;const t=G(),r=U(),n=_(),e=q(),[l,o]=A($),s=()=>{for(let d=0;d<sessionStorage.length;d++){let i=sessionStorage.key(d);i!=null&&i.startsWith("authToken")&&sessionStorage.removeItem(i)}};return f.useEffect(()=>{let d=document.querySelector("[data-web3-space]");if(d){o(d.dataset.sessionId);return}b.request(k.gql`
                {
                    sessionInfo {
                        id
                    }
                }
            `).then(i=>{o(i.sessionInfo.id)})},[]),f.useEffect(()=>{var p;const d=document.cookie.split(";");let i=null,u=d.filter(y=>y.trim().startsWith("blog_token="));u.length>0&&(u=u[0].split("="),u.length>1&&(i=u[1]));const m=i;if(console.log({has:m,loginInfo:n,accountInfo:e}),(!((p=n==null?void 0:n.tokenLogin)!=null&&p.loginToken)||!e.address)&&i){const y=k.gql`
                mutation {
                    logout
                }
            `;i&&(b.request(y).then(()=>{setTimeout(()=>{window.location.reload()},1500)}),s());return}(async()=>{if(!m&&e.address&&e.address.length>0&&n.tokenLogin.signature&&n.tokenLogin.signature.length>0){const y=k.gql`
                    mutation (
                        $address: String!
                        $signature: String!
                        $token: String
                    ) {
                        verifyLogin(
                            address: $address
                            signature: $signature
                            token: $token
                        ) {
                            success
                            # token
                        }
                    }
                `;if((await b.request(y,{address:e.address,signature:n.tokenLogin.signature,token:n.tokenLogin.loginToken})).verifyLogin.success){const h=new CustomEvent("loginVerified",{detail:{accountInfo:e,loginInfo:n}});document.dispatchEvent(h)}}})()},[(c=n==null?void 0:n.tokenLogin)==null?void 0:c.loginToken,e.address]),f.useEffect(()=>{let d=t.signedTransactionsArray.filter(i=>i[1].status==="signed"||i[1].status==="success");for(const i of d){const[u,m]=i;for(let p of m.transactions){const y=p;p=new g.Transaction(p);let h=g.TransactionPayload.fromEncoded(p.getData()).getEncodedArguments();if(h.length>0&&h[0]==="signComment"&&setTimeout(()=>{r(J({transactionHash:y.hash,sessionId:u,status:X.success})),r(K({sessionId:u,status:Q.success}))},1e3),h.length>0&&h[h.length-1]==="6d61726b506c61796564"&&m.status==="success"){const j=g.StringValue.fromHex(h[1]);let C=new g.ArgSerializer().stringToValues(h[2],[new g.EndpointParameterDefinition("nonce","nonce of nft",new g.U64Type)]);C=C[0].value.toNumber(),b.request(k.gql`
                            query clearCache(
                                $identifier: String!
                                $nonce: Int!
                                $guestAddress: String
                            ) {
                                clearPlayCount(
                                    identifier: $identifier
                                    nonce: $nonce
                                    guestAddress: $guestAddress
                                )
                            }
                        `,{identifier:j.valueOf(),nonce:C,guestAddress:e.address}).then(()=>{window.dispatchEvent(new CustomEvent("clearPlayCount",{}))})}}}},[t]),null},we=async()=>{let t=document.querySelectorAll("[data-web3-space]");if(t.length===0)return;const r=Array.from(t),n=document.getElementsByClassName("dapp-required")[0];let e=document.createElement("div");e.setAttribute("id","app"),n.appendChild(e),Y(e).render(w(me,{allAds:r,children:[a(Z,{className:"transactions-toast-list",transactionToastClassName:"transactions-toast-class",successfulToastLifetime:3e4}),a(ee,{}),a(te,{}),a(he,{})]}))};we();export{x as F,b as G,ae as _,w as a,Se as b,xe as c,a as j,$ as s,qe as t,le as u};
