import{p as de,b as $,u as le,r as o,z as ce,w as he,y as me,d as ue,Z as xe,c as d,F as be,q as pe,Y as we,v as ye,f as S,A as q,o as u,_ as F,k as V}from"./vendor-DZp4qUgB.js";import{s as ve,t as fe,G as _e,j as t,a as i,c as R,F as a,u as Se,b as _}from"./react-app-DdKy85kH.js";import"./bignumber-L0kgG1Q3.js";import"./lodash-C-76dkfd.js";const Y=S.lazy(()=>F(()=>import("./BuySpace-Cen6ZJGf.js"),[])),ge=S.lazy(()=>F(()=>import("./SpaceEdit-BlZtRRbf.js"),[])),Re=({name:w="",language:n,html:y,format:L,sidebar:l,info:U,session:ke})=>{var W;const s=de(),[x,Ne]=$(ve),f=le(),[e,X]=o.useState(U),[G,Z]=o.useState(null);o.useEffect(()=>{let r=f.configuration;r.extraInfo={sessionId:x},ce(r).initialize().then(m=>{Z(m),document.cookie=`login_token=${m};path=/;max-age=3600`})},[(W=f==null?void 0:f.configuration)==null?void 0:W.apiAddress,x]);const[M,b]=o.useState(!1),[v,g]=o.useState(!1),[J,K]=o.useState(!0),[k]=$(fe),z=(k==null?void 0:k[w])||"",[C,N]=o.useState(""),[A,D]=o.useState(null);o.useEffect(()=>{N(y||"")},[y]);const Q=async()=>{console.log(await(async()=>{await V({transactions:[{value:"0",data:"withdraw",receiver:_,gasLimit:"40000000"}],transactionsDisplayInfo:{processingMessage:n=="ro"?"Asteptam...":"Waiting...",successMessage:n=="ro"?"Au intrat banutii":"Money is in your wallet",transactionDuration:1e4}})})())},{successfulTransactionsArray:O}=he(),{pendingTransactionsArray:j}=me(),I=r=>{if(!r[1].transactions)return!1;const h=u.Transaction.fromPlainObject(r[1].transactions[0]);if(h.getReceiver().bech32()===_){let c=u.TransactionPayload.fromEncoded(h.getData().encoded()).getEncodedArguments();if(c.length===2&&c[0]==="resetSpace"&&c[1]===new u.ArgSerializer().valuesToString([new u.StringValue(e.name)]).argumentsString)return!0}return!1},ee=r=>{if(!r[1].transactions)return!1;const h=u.Transaction.fromPlainObject(r[1].transactions[0]);if(h.getReceiver().bech32()===_){let c=u.TransactionPayload.fromEncoded(h.getData().encoded()).getEncodedArguments();if(c.length===1&&c[0]==="withdraw")return!0}return!1},P=o.useMemo(()=>O.some(I),[O]),B=o.useMemo(()=>j.some(ee),[j]);o.useEffect(()=>{P&&T(e.name)},[P]);const te=async r=>{if(!r||r.length===0)return;console.log(await(async()=>{const m=new u.ArgSerializer;let c="resetSpace";c+="@"+m.valuesToString([new u.StringValue(r)]).argumentsString,await V({transactions:[{value:"0",data:c,receiver:_,gasLimit:"40000000"}],transactionsDisplayInfo:{processingMessage:n=="ro"?"Asteptam...":"Waiting...",successMessage:n=="ro"?"Spatiul a fost resetat":"Space was reset",transactionDuration:1e4}})})())},T=async r=>{const m=(await _e.request(ue.gql`
            query adSpaceInfo($spaceName: String!, $initial: Boolean) {
                adSpaceInfo(spaceName: $spaceName, initial: $initial) {
                    name
                    is_new
                    owner
                    paid_amount
                    paid_until
                }
            }
        `,{spaceName:r,initial:J})).adSpaceInfo;X(m)};o.useEffect(()=>{(async()=>e!=null&&e.name||(await T(w),K(!0)))()},[w]);const E=o.useCallback(()=>{T(w)},[w]),se=[(s==null?void 0:s.address)==R&&t("div",{style:{flexBasis:"100%",height:0}},"emtpty-div"),(s==null?void 0:s.address)==R&&i("button",{className:"p-2 bg-secondary shadow-box hover:shadow-boxhvr text-xs text-black",onClick:r=>{r.preventDefault(),Q()},children:[!B&&i(a,{children:[n=="en"&&t(a,{children:"Withdraw"}),n=="ro"&&t(a,{children:"Retrage banii"})]}),B&&t(a,{children:"..."})]},"withdraw-btn"),s.address&&s.address==R&&!(e!=null&&e.is_new)&&i("button",{className:"p-2 bg-red-500 text-white shadow-box hover:shadow-boxhvr text-xs text-black",onClick:r=>{r.preventDefault(),te((e==null?void 0:e.name)||"")},children:[n=="en"&&t(a,{children:"Reset space"}),n=="ro"&&t(a,{children:"Reseteaza spatiul"})]},"reset-btn")],H=[s.address&&s.address!=(e==null?void 0:e.owner)&&!(e!=null&&e.is_new)&&i("button",{className:"p-2 bg-secondary shadow-box hover:shadow-boxhvr text-xs text-black",onClick:r=>{r.preventDefault(),b(!0)},children:[n=="en"&&t(a,{children:"Replace with your advertisement"}),n=="ro"&&t(a,{children:"Inlocuieste cu reclama ta"})]},"replace-btn"),s.address&&s.address==(e==null?void 0:e.owner)&&!(e!=null&&e.is_new)&&!v&&i("button",{className:"p-2 bg-secondary shadow-box hover:shadow-boxhvr text-xs text-black",onClick:r=>{r.preventDefault(),g(!0)},children:[n=="en"&&t(a,{children:"Edit space"}),n=="ro"&&t(a,{children:"Editeaza spatiul"})]},"edit-btn"),s.address&&s.address==(e==null?void 0:e.owner)&&!(e!=null&&e.is_new)&&v&&i("button",{className:"p-2 bg-secondary shadow-box hover:shadow-boxhvr text-xs text-black",onClick:r=>{r.preventDefault(),g(!1)},children:[n=="en"&&t(a,{children:"Cancel edit"}),n=="ro"&&t(a,{children:"Anuleaza editarea"})]},"cancel-btn"),i("button",{className:"p-2 bg-secondary shadow-box hover:shadow-boxhvr text-xs text-black",onClick:r=>{r.preventDefault(),xe()},children:[n=="en"&&t(a,{children:"Logout"}),n=="ro"&&t(a,{children:"Logout"})]},"logout-btn"),...se].filter(Boolean),{showLogin:p,setShowLogin:ae,loginActions:re}=Se({sessionId:x});o.useEffect(()=>{s!=null&&s.address&&p&&D(null)},[p,s]),o.useEffect(()=>{s!=null&&s.address&&A&&A=="outbid"&&(e.owner&&e.owner!=s.address&&b(!0),D(null))},[A,s==null?void 0:s.address,e]);const ne=[!(e!=null&&e.is_new)&&i("button",{className:"dapp-core-component__main__btn dapp-core-component__main__btn-primary dapp-core-component__main__m-1 text-xs p-2 mx-0 bg-yellow-500 shadow-box hover:shadow-boxhvr text-black",onClick:r=>{r.preventDefault(),s!=null&&s.address?b(!0):(ae(!p),D(p?null:"outbid"))},children:[p&&i(a,{children:[n=="en"&&t(a,{children:"Cancel outbid"}),n=="ro"&&t(a,{children:"Renunta"})]}),!p&&i(a,{children:[n=="en"&&t(a,{children:"Replace with your advertisement"}),n=="ro"&&t(a,{children:"Inlocuieste cu reclama ta"})]})]},"login-btn"),...re].filter(Boolean);if(!(e!=null&&e.name)&&y&&y.length>1)return t(a,{children:t("div",{className:d("bg-primary py-4 px-4",{}),children:e&&!(e!=null&&e.is_new)&&t("div",{className:"space__content",dangerouslySetInnerHTML:{__html:v?z:C}})})});if(e!=null&&e.is_new)return t("div",{className:d("py-4 px-4",{"bg-primary":L=="light","bg-splash text-white":L=="dark"}),children:i("div",{className:"flex flex-col items-center justify-center",children:[(!s.address||s.address&&e.owner!=s.address)&&i(a,{children:[n=="ro"&&i(a,{children:[t("div",{className:d("font-bold text-center",{"text-2xl":!l,"mb-4":l}),children:"Acest spatiu publicitar poate fi tau pentru 10 de zile."}),i("p",{className:d("text-center",{"mb-4":l}),children:["Costa doar ",e==null?void 0:e.paid_amount," USDC/USDT / 10 zile.",t("br",{}),"Il inchiriezi instant cu ajutorul blockchain-ului MultiversX si il poti personaliza cum vrei tu."]})]}),n=="en"&&i(a,{children:[t("div",{className:d("font-bold",{"text-2xl":!l,"mb-4":l}),children:"This ad space can be yours for 10 days."}),i("p",{className:d("text-center",{"mb-4":l}),children:["It costs only ",e==null?void 0:e.paid_amount," USDC/USDT per 10 days.",t("br",{})," You rent it instantly using the MultiversX blockchain and you can customize it as you want."]})]})]}),!s.address&&t(a,{children:i("div",{className:d("flex mt-2 flex-col items-center md:flex-row",{"flex flex-col md:flex-col gap-2":l}),children:[t(be,{nativeAuth:!0,token:x,logoutRoute:window.location.href,className:"text-xs p-2 mx-0 bg-secondary shadow-box hover:shadow-boxhvr text-black border-secondary"}),t(pe,{token:x,showScamPhishingAlert:!0,className:"text-xs p-2 ml-4 bg-secondary shadow-box hover:shadow-boxhvr text-black  border-secondary"}),t(we,{className:"text-xs p-2 mx-0 bg-secondary shadow-box hover:shadow-boxhvr text-black border-secondary",token:x,loginButtonText:"MultiversX DeFi Wallet"}),t(ye,{token:G,callbackRoute:window.location.pathname,className:"text-xs p-2 mx-0 ml-4 bg-secondary shadow-box hover:shadow-boxhvr text-black border-secondary"})]})}),s.address&&e.owner!=s.address&&t(a,{children:t("div",{className:d("mt-2",{"mt-4":l}),children:i("button",{className:"p-2 bg-secondary text-black shadow-box hover:shadow-boxhvr text-xs",onClick:r=>{r.preventDefault(),b(!0)},children:[n=="ro"&&t(a,{children:"Inchiriaza acest spatiu"}),n=="en"&&t(a,{children:"Rent this space"})]})})}),s.address&&t(a,{children:t("div",{className:d("mt-3 flex flex-wrap self-end justify-end gap-2 ml-auto",{"mt-4 transform scale-75 origin-right":l}),style:{width:"fit-content"},children:H})}),t(S.Suspense,{fallback:t("div",{}),children:t(Y,{open:M,setOpen:b,spaceInfo:e,language:n,refreshSpace:E})})]})});const ie=e!=null&&e.paid_until?q(new Date((e==null?void 0:e.paid_until)*1e3),"dd.MM.yyyy HH:mm"):"",oe=e!=null&&e.paid_until?q(new Date((e==null?void 0:e.paid_until)*1e3),"MM-dd-yyyy HH:mm a"):"";return i(a,{children:[i("div",{className:d("bg-primary py-4 px-4",{}),children:[(s==null?void 0:s.address)&&(e==null?void 0:e.owner)==s.address&&t(a,{children:i("div",{className:d("font-bold text-xs bg-secondary py-2 px-4 rounded-2xl max-w border border-black mb-2"),style:{maxWidth:"fit-content"},children:[n=="ro"&&i(a,{children:["Deti acest spatiu pana in ",ie]}),n=="en"&&i(a,{children:["You own this space until ",oe]})]})}),e&&!(e!=null&&e.is_new)&&t("div",{className:"space__content",dangerouslySetInnerHTML:{__html:v?z:C}}),v&&t(a,{children:t(o.Suspense,{fallback:t("div",{children:"Loading"}),children:t(ge,{spaceInfo:e,close:()=>{g(!1)},sidebar:l,language:n,refreshSpace:r=>{E(),N(r)}})})}),e.name&&i(a,{children:[s.address&&t("div",{className:d("mt-3 flex flex-wrap self-end justify-end gap-2 ml-auto",{"mt-4 transform scale-75 origin-right":l}),style:{width:"fit-content"},children:H}),!(s!=null&&s.address)&&t("div",{className:d("mt-3 self-end flex gap-2 justify-end",{"flex-col mt-4":l}),children:ne})]})]}),t(S.Suspense,{fallback:t("div",{}),children:t(Y,{open:M,setOpen:b,spaceInfo:e,language:n,refreshSpace:E})})]})};export{Re as default};
