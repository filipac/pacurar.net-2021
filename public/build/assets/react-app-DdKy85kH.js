import{j as C,r as u,p as k,F as R,q as V,Y as I,v as M,R as E,b as S,x as N,c as B,Z as z,d as b,e as _,o as g,n as T,C as F,k as W,f as x,_ as D,g as O,h as H,i as U,l as G,Q as J,I as X,V as K,m as Q,s as Y,B as Z,J as ee,t as te}from"./vendor-DZp4qUgB.js";import"./bignumber-L0kgG1Q3.js";import"./lodash-C-76dkfd.js";const v=C.Fragment,a=C.jsx,h=C.jsxs,ne="mainnet",se="6849db0c57e4bf778ed8bdd2d721ee4f",pe="erd1qqqqqqqqqqqqqpgqq72p4p73sx6wkurl3epefzt4dkvwh7frvp3s73l9k6",ae="erd1qqqqqqqqqqqqqpgq8c2s6jf7je90x5wy843c2e8nlekejrf7vp3sxrvnka",ye="erd158lk5s2m3cpjyg5fwgm0pwnt8ugnc29mj4nafkrvcrhfdfpgvp3swpmnrj",oe=({sessionId:e,initialShowLogin:o})=>{const[n,t]=u.useState(o||!1),l=k();u.useEffect(()=>{l!=null&&l.address&&n&&t(o)},[n,l]);const d=[n&&a(R,{nativeAuth:!0,token:e,logoutRoute:window.location.href,loginButtonText:"xPortal",className:"text-xs p-2 mx-0 bg-secondary shadow-box hover:shadow-boxhvr text-black"},"wallet-connect"),n&&a(V,{token:e,className:"text-xs p-2 mx-0 bg-secondary shadow-box hover:shadow-boxhvr text-black"},"ledger"),n&&a(I,{className:"text-xs p-2 mx-0 bg-secondary shadow-box hover:shadow-boxhvr text-black",token:e,loginButtonText:"MultiversX DeFi Wallet"},"ext"),n&&a(M,{token:e,callbackRoute:window.location.pathname,className:"text-xs p-2 mx-0 bg-secondary shadow-box hover:shadow-boxhvr text-black",onLoginRedirect:{callbackRoute:window.location.pathname},nativeAuth:!0},"web")].filter(Boolean);return{showLogin:n,setShowLogin:t,loginActions:d}},L=E({key:"session",default:""}),be=E({key:"tempAd",default:{_title:""}}),P=E({key:"timesPlayed",default:{}}),re=e=>{const[o,n]=S(L),t=k();N();const{loginActions:l}=oe({sessionId:o,initialShowLogin:!0}),d=[...l].filter(Boolean);return u.useEffect(()=>{if(!e.login)return;let s=function(r){e.intended?window.location.href=e.intended:r.detail.loginInfo.loginMethod!=="wallet"&&window.location.reload()};return document.addEventListener("loginVerified",s),()=>{document.removeEventListener("loginVerified",s)}},[e.login,e.intended]),a(v,{children:h("div",{className:B("mt-3 flex gap-2",{"flex-col mt-4":!1,"self-end justify-end":!e.login,"self-center justify-center":e.login}),children:[!(t!=null&&t.address)&&a(v,{children:d}),t.address&&a(v,{children:a("button",{className:"p-2 bg-secondary shadow-box hover:shadow-boxhvr text-xs text-black",onClick:s=>{s.preventDefault(),z()},children:"Logout"})})]})})},y=new b.GraphQLClient("/gql");y.setHeader("X-Requested-With","XMLHttpRequest");y.setHeader("Accept","application/json");const ie=e=>{const o=k(),[n,t]=S(P),l=Array.from(document.querySelectorAll("[data-game-counter-mini-app]")),d=u.useCallback(async()=>{let s=await y.batchRequests(e.nfts.map(i=>({document:b.gql`
                    query timesPlayedNft($identifier: String!, $nonce: Int!, $guestAddress: String) {
                        timesPlayedNft(identifier: $identifier, nonce: $nonce, guestAddress: $guestAddress) {
                            nonce
                            played_by_filip
                            played_by_you
                        }
                    }
                `,variables:{identifier:i.identifier,nonce:i.nonce,guestAddress:(o==null?void 0:o.address)||null}}))),r={};for(let i of s)r[i.data.timesPlayedNft.nonce]=i.data.timesPlayedNft;t(r)},[e.nfts,o.address]);return u.useEffect(()=>{const s=()=>{d()};return window.addEventListener("clearPlayCount",s),()=>{window.removeEventListener("clearPlayCount",s)}},[]),u.useEffect(()=>{e.nfts&&e.nfts.length>0&&d()},[e.nfts,o.address]),a(v,{children:l.map(s=>{const r=JSON.parse(s.dataset.nft);return _.createPortal(a(le,{nft:r,owner:s.dataset.owner},`mini-app-${e.ikey}-${r.identifier}`),s)})})},le=e=>{const[o,n]=S(P),t=o[e.nft.nonce]||{played_by_filip:0,played_by_you:0},l=k(),d=u.useCallback(async()=>{const s=new g.ArgSerializer;let r="ESDTNFTTransfer";r+="@"+s.valuesToString([new g.StringValue(e.nft.collection)]).argumentsString,r+="@"+s.valuesToString([new T.U64Value(e.nft.nonce)]).argumentsString,r+="@"+s.valuesToString([new T.U64Value(1)]).argumentsString,r+="@"+s.valuesToString([new g.AddressValue(new g.Address(ae))]).argumentsString,r+="@"+s.valuesToString([new g.StringValue("markPlayed")]).argumentsString;const i={value:"0",data:r,receiver:l.address,gasLimit:"60000000"};await F();const{sessionId:c}=await W({transactions:i,transactionsDisplayInfo:{processingMessage:"Processing increment game play counter transaction...",errorMessage:"Error incrementing game play counter",successMessage:"Successfully incremented game play counter"},redirectAfterSign:!1})},[e.nft]);return h("div",{className:"flex flex-col items-center",children:[h("div",{className:"font-bold text-sm mt-2 mb-2",children:["Number of times played by Filip: ",t==null?void 0:t.played_by_filip]}),l.address&&h("div",{className:"flex flex-col items-center",children:[l.address!=e.owner&&h("div",{className:"font-bold text-sm mb-2",children:["Number of times played by you: ",t==null?void 0:t.played_by_you]}),l.address==e.nft.owner&&a("div",{children:a("button",{className:"inline-block group bg-mxYellow hover:shadow-boxhvr p-1 hover:pb-3 shadow-box border-2 border-black text-xs",onClick:d,children:a("span",{className:"relative show-border smaller",children:"++ Increment play count"})})})]})]})},ce=()=>{const[,e]=x.useState(),o=x.useCallback(()=>e({}),[]),[n,t]=x.useState(0);let l=Array.from(document.querySelectorAll("[data-web3-state-management]")),d=document.querySelector("[data-game-counter-app]");return window.rerenderLivewireableComponents=()=>{t(s=>s+1),o()},h(v,{children:[l.map(s=>{let r=!1;s.dataset.login==="1"&&(r=!0);const i=s.dataset.intended;return _.createPortal(a(u.Suspense,{fallback:a("div",{}),children:a(re,{login:r,intended:i})}),s)}),d&&_.createPortal(a(u.Suspense,{fallback:a("div",{}),children:a(ie,{nfts:JSON.parse(d.dataset.nfts),ikey:n})}),d,`game-counter-${n}`)]})};x.lazy(()=>D(()=>import("./MainAdSpaceApp-D00J3m4g.js"),[]));const de=({children:e,allAds:o})=>{const[,n]=x.useState();return x.useCallback(()=>n({}),[]),a(O,{children:h(H,{environment:ne,customNetworkConfig:{name:"customConfig",apiTimeout:6e3,walletConnectV2ProjectId:se},dappConfig:{shouldUseWebViewProvider:!0,logoutRoute:window.location.href},children:[e,a(ce,{})]})})},ue=()=>{var r;const e=U(),o=G(),n=N(),t=k(),[l,d]=S(L),s=()=>{for(let i=0;i<sessionStorage.length;i++){let c=sessionStorage.key(i);c!=null&&c.startsWith("authToken")&&sessionStorage.removeItem(c)}};return u.useEffect(()=>{let i=document.querySelector("[data-web3-space]");if(i){d(i.dataset.sessionId);return}y.request(b.gql`
                {
                    sessionInfo {
                        id
                    }
                }
            `).then(c=>{d(c.sessionInfo.id)})},[]),u.useEffect(()=>{var w;const i=document.cookie.split(";");let c=null,m=i.filter(p=>p.trim().startsWith("blog_token="));m.length>0&&(m=m[0].split("="),m.length>1&&(c=m[1]));const q=c;if((!((w=n==null?void 0:n.tokenLogin)!=null&&w.loginToken)||!t.address)&&c){const p=b.gql`
                mutation {
                    logout
                }
            `;c&&(y.request(p).then(()=>{setTimeout(()=>{window.location.reload()},300)}),s());return}(async()=>{if(!q&&t.address&&t.address.length>0&&n.tokenLogin.signature&&n.tokenLogin.signature.length>0){const p=b.gql`
                    mutation (
                        $address: String!
                        $signature: String!
                        $token: String
                    ) {
                        verifyLogin(
                            address: $address
                            signature: $signature
                            token: $token
                        ) {
                            success
                            # token
                        }
                    }
                `;if((await y.request(p,{address:t.address,signature:n.tokenLogin.signature,token:n.tokenLogin.loginToken})).verifyLogin.success){const f=new CustomEvent("loginVerified",{detail:{accountInfo:t,loginInfo:n}});document.dispatchEvent(f)}}})()},[(r=n==null?void 0:n.tokenLogin)==null?void 0:r.loginToken,t.address]),u.useEffect(()=>{let i=e.signedTransactionsArray.filter(c=>c[1].status==="signed"||c[1].status==="success");for(const c of i){const[m,q]=c;for(let w of q.transactions){const p=w;w=new g.Transaction(w);let f=g.TransactionPayload.fromEncoded(w.getData()).getEncodedArguments();if(f.length>0&&f[0]==="signComment"&&setTimeout(()=>{o(J({transactionHash:p.hash,sessionId:m,status:X.success})),o(K({sessionId:m,status:Q.success}))},1e3),f.length>0&&f[f.length-1]==="6d61726b506c61796564"&&q.status==="success"){const j=g.StringValue.fromHex(f[1]);let A=new g.ArgSerializer().stringToValues(f[2],[new g.EndpointParameterDefinition("nonce","nonce of nft",new g.U64Type)]);A=A[0].value.toNumber(),y.request(b.gql`
                            query clearCache(
                                $identifier: String!
                                $nonce: Int!
                                $guestAddress: String
                            ) {
                                clearPlayCount(
                                    identifier: $identifier
                                    nonce: $nonce
                                    guestAddress: $guestAddress
                                )
                            }
                        `,{identifier:j.valueOf(),nonce:A,guestAddress:t.address}).then(()=>{window.dispatchEvent(new CustomEvent("clearPlayCount",{}))})}}}},[e]),null};window._global||(window._global=window),window.global=window._global;const ge=async()=>{let e=document.querySelectorAll("[data-web3-space]");if(e.length===0)return;const o=Array.from(e),n=document.getElementsByClassName("dapp-required")[0];let t=document.createElement("div");t.setAttribute("id","app"),n.appendChild(t),Y.createRoot(t).render(h(de,{allAds:o,children:[a(Z,{className:"transactions-toast-list",transactionToastClassName:"transactions-toast-class",successfulToastLifetime:3e4}),a(ee,{}),a(te,{}),a(ue,{})]}))};ge();export{v as F,y as G,h as a,pe as b,ye as c,a as j,L as s,be as t,oe as u};
