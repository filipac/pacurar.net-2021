import{j as C,r as u,m as x,J as j,U as I,H as M,C as V,R as N,b as v,c as B,G as H,d as b,e as q,o as f,f as $,N as O,g as W,h as S,i as z,k as D,l as F,n as G,p as U,Q as J,q as X,V as K,s as Q,t as Y,P as Z,u as ee,I as te}from"./vendor-65e31ccf.js";import"./lodash-0223fb8a.js";import"./bignumber-63705fc6.js";const k=C.Fragment,n=C.jsx,h=C.jsxs,se="modulepreload",ne=function(s){return"/wp-content/themes/pacurar2020/public/"+s},L={},ae=function(i,t,e){if(!t||t.length===0)return i();const c=document.getElementsByTagName("link");return Promise.all(t.map(r=>{if(r=ne(r),r in L)return;L[r]=!0;const a=r.endsWith(".css"),d=a?'[rel="stylesheet"]':"";if(!!e)for(let o=c.length-1;o>=0;o--){const m=c[o];if(m.href===r&&(!a||m.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${r}"]${d}`))return;const l=document.createElement("link");if(l.rel=a?"stylesheet":se,a||(l.as="script",l.crossOrigin=""),l.href=r,document.head.appendChild(l),a)return new Promise((o,m)=>{l.addEventListener("load",o),l.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${r}`)))})})).then(()=>i())},re="mainnet",oe="6849db0c57e4bf778ed8bdd2d721ee4f",xe="erd1qqqqqqqqqqqqqpgqq72p4p73sx6wkurl3epefzt4dkvwh7frvp3s73l9k6",ie="erd1qqqqqqqqqqqqqpgq8c2s6jf7je90x5wy843c2e8nlekejrf7vp3sxrvnka",qe="erd158lk5s2m3cpjyg5fwgm0pwnt8ugnc29mj4nafkrvcrhfdfpgvp3swpmnrj",ce=({sessionId:s,initialShowLogin:i})=>{const[t,e]=u.useState(i||!1),c=x();u.useEffect(()=>{c!=null&&c.address&&t&&e(i)},[t,c]);const r=[t&&n(j,{isWalletConnectV2:!0,token:s,logoutRoute:window.location.href,showScamPhishingAlert:!0,className:"text-xs p-2 mx-0 bg-secondary shadow-box hover:shadow-boxhvr text-black"},"wallet-connect"),t&&n(I,{token:s,showScamPhishingAlert:!0,className:"text-xs p-2 mx-0 bg-secondary shadow-box hover:shadow-boxhvr text-black"},"ledger"),t&&n(M,{className:"text-xs p-2 mx-0 bg-secondary shadow-box hover:shadow-boxhvr text-black",token:s,loginButtonText:"MultiversX DeFi Wallet"},"ext"),t&&n(V,{token:s,callbackRoute:window.location.pathname,className:"text-xs p-2 mx-0 bg-secondary shadow-box hover:shadow-boxhvr text-black",onLoginRedirect:{callbackRoute:window.location.pathname},nativeAuth:!0},"web")].filter(Boolean);return{showLogin:t,setShowLogin:e,loginActions:r}},E=N({key:"session",default:""}),ve=N({key:"tempAd",default:{_title:""}}),_=N({key:"timesPlayed",default:{}}),le=()=>{const[s,i]=v(E),t=x(),{loginActions:e}=ce({sessionId:s,initialShowLogin:!0}),c=[...e].filter(Boolean);return n(k,{children:h("div",{className:B("mt-3 self-end flex gap-2 justify-end",{"flex-col mt-4":!1}),children:[!(t!=null&&t.address)&&n(k,{children:c}),t.address&&n(k,{children:n("button",{className:"p-2 bg-secondary shadow-box hover:shadow-boxhvr text-xs text-black",onClick:r=>{r.preventDefault(),H()},children:"Logout"})})]})})},y=new b.GraphQLClient("/gql");y.setHeader("X-Requested-With","XMLHttpRequest");y.setHeader("Accept","application/json");const de=s=>{const i=x(),[t,e]=v(_),c=Array.from(document.querySelectorAll("[data-game-counter-mini-app]")),r=u.useCallback(async()=>{let a=await y.batchRequests(s.nfts.map(g=>({document:b.gql`
                    query timesPlayedNft($identifier: String!, $nonce: Int!, $guestAddress: String) {
                        timesPlayedNft(identifier: $identifier, nonce: $nonce, guestAddress: $guestAddress) {
                            nonce
                            played_by_filip
                            played_by_you
                        }
                    }
                `,variables:{identifier:g.identifier,nonce:g.nonce,guestAddress:(i==null?void 0:i.address)||null}}))),d={};for(let g of a)d[g.data.timesPlayedNft.nonce]=g.data.timesPlayedNft;e(d)},[s.nfts,i.address]);return u.useEffect(()=>{const a=()=>{r()};return window.addEventListener("clearPlayCount",a),()=>{window.removeEventListener("clearPlayCount",a)}},[]),u.useEffect(()=>{s.nfts&&s.nfts.length>0&&r()},[s.nfts,i.address]),n(k,{children:c.map(a=>{const d=JSON.parse(a.dataset.nft);return q.createPortal(n(ue,{nft:d,owner:a.dataset.owner},`mini-app-${s.ikey}-${d.identifier}`),a)})})},ue=s=>{const[i,t]=v(_),e=i[s.nft.nonce]||{played_by_filip:0,played_by_you:0},c=x(),r=u.useCallback(async()=>{const a=new f.ArgSerializer;let d="ESDTNFTTransfer";d+="@"+a.valuesToString([new f.StringValue(s.nft.collection)]).argumentsString,d+="@"+a.valuesToString([new $(s.nft.nonce)]).argumentsString,d+="@"+a.valuesToString([new $(1)]).argumentsString,d+="@"+a.valuesToString([new f.AddressValue(new f.Address(ie))]).argumentsString,d+="@"+a.valuesToString([new f.StringValue("markPlayed")]).argumentsString;const g={value:"0",data:d,receiver:c.address,gasLimit:"60000000"};await O(),await W({transactions:g,transactionsDisplayInfo:{processingMessage:"Processing increment game play counter transaction...",errorMessage:"Error incrementing game play counter",successMessage:"Successfully incremented game play counter"},redirectAfterSign:!1})},[s.nft]);return h("div",{className:"flex flex-col items-center",children:[h("div",{className:"font-bold text-sm mt-2 mb-2",children:["Number of times played by Filip: ",e==null?void 0:e.played_by_filip]}),c.address&&h("div",{className:"flex flex-col items-center",children:[c.address!=s.owner&&h("div",{className:"font-bold text-sm mb-2",children:["Number of times played by you: ",e==null?void 0:e.played_by_you]}),c.address==s.nft.owner&&n("div",{children:n("button",{className:"inline-block group bg-mxYellow hover:shadow-boxhvr p-1 hover:pb-3 shadow-box border-2 border-black text-xs",onClick:r,children:n("span",{className:"relative show-border smaller",children:"++ Increment play count"})})})]})]})},ge=()=>{const[,s]=S.useState(),i=S.useCallback(()=>s({}),[]),[t,e]=S.useState(0);let c=Array.from(document.querySelectorAll("[data-web3-state-management]")),r=document.querySelector("[data-game-counter-app]");return window.rerenderLivewireableComponents=()=>{e(a=>a+1),i()},h(k,{children:[c.map(a=>q.createPortal(n(u.Suspense,{fallback:n("div",{}),children:n(le,{})}),a)),r&&q.createPortal(n(u.Suspense,{fallback:n("div",{}),children:n(de,{nfts:JSON.parse(r.dataset.nfts),ikey:t})}),r,`game-counter-${t}`)]})},me=S.lazy(()=>ae(()=>import("./MainAdSpaceApp-758f2e4f.js"),["assets/MainAdSpaceApp-758f2e4f.js","assets/vendor-65e31ccf.js","assets/bignumber-63705fc6.js","assets/lodash-0223fb8a.js"])),fe=({children:s,allAds:i})=>{const[,t]=S.useState();return S.useCallback(()=>t({}),[]),n(z,{children:h(D,{environment:re,customNetworkConfig:{walletConnectV2ProjectId:oe},dappConfig:{logoutRoute:window.location.href},children:[s,i.map(e=>{if(e.dataset.rendered==="true")return!1;const c=e.innerHTML;return e.innerHTML="",setTimeout(()=>{e.dataset.rendered="true"}),q.createPortal(n(u.Suspense,{fallback:n("div",{}),children:n(me,{name:e.dataset.spaceName,language:e.dataset.language,format:e.dataset.format,sidebar:e.dataset.sidebar==1,info:e.dataset.initialInfo?JSON.parse(e.dataset.initialInfo):{},session:e.dataset.sessionId,html:c})}),e)}).filter(e=>e!==!1),n(ge,{})]})})},he=()=>{var g;const s=F(),i=G(),t=U(),e=x(),[c,r]=v(E),a=()=>{for(let l=0;l<sessionStorage.length;l++){let o=sessionStorage.key(l);o!=null&&o.startsWith("authToken")&&sessionStorage.removeItem(o)}},d=()=>{for(let l=0;l<sessionStorage.length;l++){let o=sessionStorage.key(l);if(o!=null&&o.startsWith("authToken"))return!0}return!1};return u.useEffect(()=>{let l=document.querySelector("[data-web3-space]");if(l){r(l.dataset.sessionId);return}y.request(b.gql`
            { sessionInfo { id } }
        `).then(o=>{r(o.sessionInfo.id)})},[]),u.useEffect(()=>{var o;if(!((o=t==null?void 0:t.tokenLogin)!=null&&o.loginToken)||!e.address){const m=b.gql`
                mutation {
                    logout
                }
            `;d()&&(y.request(m),a());return}const l=sessionStorage.getItem(`authToken${e.address}${t.tokenLogin.loginToken}`);(async()=>{if(!l){const m=b.gql`
                    mutation($address: String!, $signature: String!, $token: String) {
                        verifyLogin(address: $address, signature: $signature, token: $token) {
                            success
                            # token
                        }
                    }
                `;if((await y.request(m,{address:e.address,signature:t.tokenLogin.signature,token:t.tokenLogin.loginToken})).verifyLogin.success){const w="1";sessionStorage.setItem(`authToken${e.address}${t.tokenLogin.loginToken}`,w)}}})()},[(g=t==null?void 0:t.tokenLogin)==null?void 0:g.loginToken,e.address]),u.useEffect(()=>{let l=s.signedTransactionsArray.filter(o=>o[1].status==="signed"||o[1].status==="success");for(const o of l){const[m,A]=o;for(let w of A.transactions){const P=w;w=new f.Transaction(w);let p=f.TransactionPayload.fromEncoded(w.getData()).getEncodedArguments();if(p.length>0&&p[0]==="signComment"&&setTimeout(()=>{i(J({transactionHash:P.hash,sessionId:m,status:X.success})),i(K({sessionId:m,status:Q.success}))},1e3),p.length>0&&p[p.length-1]==="6d61726b506c61796564"&&A.status==="success"){const R=f.StringValue.fromHex(p[1]);let T=new f.ArgSerializer().stringToValues(p[2],[new f.EndpointParameterDefinition("nonce","nonce of nft",new f.U64Type)]);T=T[0].value.toNumber(),y.request(b.gql`
                        query clearCache($identifier: String!, $nonce: Int!, $guestAddress: String) {
                            clearPlayCount(identifier: $identifier, nonce: $nonce, guestAddress: $guestAddress)
                        }
                    `,{identifier:R.valueOf(),nonce:T,guestAddress:e.address}).then(()=>{window.dispatchEvent(new CustomEvent("clearPlayCount",{}))})}}}},[s]),null},pe=async()=>{let s=document.querySelectorAll("[data-web3-space]");if(s.length===0)return;const i=Array.from(s),t=document.getElementsByClassName("dapp-required")[0];let e=document.createElement("div");e.setAttribute("id","app"),t.appendChild(e),Y(e).render(h(fe,{allAds:i,children:[n(Z,{className:"transactions-toast-list",transactionToastClassName:"transactions-toast-class",successfulToastLifetime:3e4}),n(ee,{}),n(te,{}),n(he,{})]}))};pe();export{k as F,y as G,ae as _,h as a,xe as b,qe as c,n as j,E as s,ve as t,ce as u};
